%SP, 31/03/10

\documentclass[article]{revtex4-1}
\usepackage[brazil]{babel}
\usepackage{epsfig}% Include figure files
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math   % for math
\usepackage{amssymb}
\usepackage{xcolor}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[nodayofweek,level]{datetime}
\usepackage{lineno, blindtext}
\usepackage{scrextend}
\usepackage{lipsum}


\newcommand{\cc}{\c{c}}
\def\ao{\~ao\ }
\def\aos{\~aos\ }
\def\oe{\~oe\ }
\def\oes{\~oes\ }
\def\coes{\c c\~oes\ }
\def\cao{\c c\~ao\ }

\newcommand{\code}[1]{\bigskip\noindent\begin{addmargin}[3em]{1em}\begin{linenumbers}\texttt{#1}\end{linenumbers}\end{addmargin}\bigskip}

\newcommand{\nocode}[1]{\texttt{#1}}

\begin{document}








\thispagestyle{empty}

%%%%%%%%%%%%%
%%% Cover %%%
%%%%%%%%%%%%%
\begin{center}\Large\scshape
viscous Ultrarelativistic Smoothed Particle hydrodynamics
\end{center}
\vspace*{1.8cm}
\begin{center}\LARGE
{\sc V-USPhydro Manual}
\end{center}
\vspace{8.0ex}
%\begin{flushright}
%\begin{minipage}{0.5\textwidth}
%\end{minipage}
%\end{flushright}
\begin{minipage}{1\textwidth}
\begin{center}
{\sc Dr.\ Jacquelyn Michelle Noronha-Hostler}\\
\vspace{8.0ex}
{\sc  Original Authors:  Jacquelyn Noronha-Hostler, Gabriel Denicol, Jorge Noronha, Rone P. G. Andrade, and Frederique Grassi}\\
\vspace{8.0ex}
{\sc Universidade de S\ao Paulo}\\
\vspace{8.0ex}
\end{center}
\end{minipage}
\vspace*{1.5ex}
\vspace*{\stretch{1}}
\begin{center}
S\~ao Paulo, \today
\end{center}

\clearpage


\newpage


\section{Introduction}

v-USPhydro is a  viscous relativistic 2+1 hydrodynamical code that uses the Langragian (Smooth Particle Hydrodynamics, SPH) method to solve the equations of motion.  In this version there is infrastructure to write the 3+1 version but it is not yet set up.  The Cooper Frye freeze-out and decays are found either in subfolders df (analytical solutions, no decays) or sampling (Monte Carlo sampling+decays).  The respective flow harmonics are calculated within each routine. The main papers for the code are \cite{code} and all equations of motion and in depth details can be found there.  When writing papers about v-USPhydro make sure to check Sec. \ref{sec:cite} to know what papers to cite. 




\section{What to Cite}\label{sec:cite}

\begin{itemize}
\item Must cite these every time the code is used \cite{code} 
\item Reasoning behind low switching temperature \cite{freezeouttemp} 
\item If you use a temperature dependent $\eta/s$ or $\zeta/s$ cite this for the low temperature region of $\eta/s$ and when discussing the peak of the bulk at $T_c$ \cite{lowetas}, the high temperature region is from lattice data \cite{Nakamura:2004sy}, the paramaterization is done is \cite{Niemi:2012ry}, the shear relaxation time is from \cite{Denicol:2010xn,Denicol:2011fa}, the bulk is inspired by Buchel's formula  for a strongly coupled plasma \cite{Buchel:2007mf}, and the bulk relaxation time is from \cite{Huang:2010sa}
\item Other papers that investigate bulk viscosity in relativistic hydrodynamics \cite{Song:2009rh,Bozek:2009dw,Monnai:2009ad,Denicol:2009am,Denicol:2010tr,Dusling:2011fd}
\item Papers studying the effects of $\eta/s$ alone \cite{etas}
\item Papers studying the consequence of large $\zeta/s$ (besides our own): \cite{Torrieri:2007fb,Rajagopal:2009yw,Habich:2014tpa}
\item Various types of $\delta f$: moments \cite%
{Denicol:2012cn,Denicol:2012yr,code}, Hirano \cite{Monnai:2009ad}, Dusling \cite{Dusling:2011fd}, $\eta_i/\eta$ corrections \cite{Molnar:2014fva}, and Bozek \cite{Bozek:2009dw}
\item Original SPH citations \cite{originalSPH,SPHothers,Aguiar:2000hw}
\item For the MC Glauber and mckln (CGC) initial condtions \cite{ic} and NeXus \cite{Drescher:2000ha}
\item The Equation of state is EOS S95n-v1 from  \cite{Huovinen:2009yb} (for lower temperatures, i.e., $T < 50$ MeV this equation of state is matched to that of a massive gas
of pions).  
\item When you use UrQMD you must cite \cite{urqmd}. There is a citation from Chun Shen that will hopefully be out soon that is also needed.
\end{itemize}

Work done with \nocode{VISHNU}+UrQMD (2+1 code) that is good to read both for understanding and good to cite is:
\begin{itemize}
\item Fitting RHIC spectra \cite{Song:2011hk}, switching temperature/Equation of State \cite{Song:2010aq} and flow harmonics \cite{Song:2010mg}.  
\item The effect of various number of resonance decays on the final flow harmonics \cite{Qiu:2012tm} (note this is NOT with UrQMD)
\item Spectra and elliptical flow for LHC and RHIC \cite{Song:2011qa,Song:2013qma}
\end{itemize}

\section{Input File}\label{sec:input}

Almost all necessary parameters can be defined within your input file.  There are a handful of exceptions that must be edited in the code directly (and they will be covered in their own sections later on in this manual.  It's also important to note that the input file must be in the order listed here, otherwise it will not run correctly.

The input can be called whatever you like, however, if you want to do multiple runs you MUST include a number after the name i.e. input2.dat and name the run and corresponding \nocode{dfinputfilename} with the same number (see Sec. \ref{sec:run}). 

The input file should have the following structure:

\code{h: $\#$	dt: $\#$ \\
equationsofmotion: ideal/bulk/shear+bulk EOS: type+files \\
low: on/off \\
viscfac\textunderscore bulk\textunderscore shear: $\#$ $\#$ \\
t0: $\#$ \\
freezeoutT: $\#$ \\
eventbyevent/giorgio/gubser $\#$ \\
ICs: foldername \\
output\textunderscore folder: foldername \\
$\#$ $\#$ \\
freezeout: 0/1/2 (if 1 see Sec.\ \ref{sec:frz1} and if 2 see Sec.\ \ref{sec:frz2}) 
}

{\bf Line 1: } Define h (the SPH smoothing parameter), for MC Glauber h=0.3 is reasonable.  Define dt (the time step), dt=0.1 is normally reasonable unless doing the Gubser test.  Note that the relaxation time should NOT be smaller than dt.

{\bf Line 2-3: } Define the equation of motion (either ideal, bulk or shear+bulk).  If you want to run shear only (no bulk), use shear+bulk and then set the bulk constant to zero on Line 4.  Define the Equation of State type either ideal or table. If you use ideal then Line 3 should be set to off.  If you use table then you must list the tables used (see Sec. \ref{sec:eos} for the format of the files) and Line 3 should be set to off. An example of this would be:

\code{equationsofmotion: ideal EOS: table\\
temp.dat\\
derv.dat\\
low: on}  

{\bf Line 4:} define the multiplying factor times $\zeta/s$ and $\eta/s$, respectively.  The form of the function can be changed in the code itself (see Sec. \ref{sec:visc} but a multiplying constant can still be included in front of any form to run checks.

{\bf Line 5:} Initial time, usually $\tau_0=1$ for RHIC and $\tau_0=0.6$ for LHC (in fm). 

{\bf Line 6:} Define the freezeout temperature (in MeV)

{\bf Line 7:} Define the type of initial conditions and then the multiplying factor (if no factor is needed simply write 1) e.g. 

\code{eventbyevent 1}

{\bf Line 8:} Define the folder where the initial conditions are found (all initial conditions should be in the folder inputfiles so you do not need to include that in the definition) e.g.

\code{ICs: rhic}

{\bf Line 9:} Define the output folder. Often this has the same name as the input folder.

{\bf Line 10:} If you defined the initial conditions as eventbyevent or giorgio then this line should have the number of the first event and the last event

{\bf Line 11:} If you only want to run hydro then freezeout=0.  If you want to run with the analytical cooper frye solution freezeout=1 and see Sec.\ \ref{sec:frz1} for further definitions.  If you want to run with Monte Carlo Sampling then freezeout=2 and see Sec.\ \ref{sec:frz2} for further definitions

\subsection{Exceptions}

The following changes must be done to the code itself:

\begin{itemize}
\item Change in the form of $\zeta/s$ and $\eta/s$ (see Sec. \ref{sec:visc})
\item Gubser and TECHQM tests (see Sec. \ref{sec:visc} and Sec. \ref{sec:tests})
\item Output format (see Sec. \ref{sec:out})
\item Adding extra terms to Equation of motion (see Sec. \ref{sec:hydro})
\end{itemize}

\subsection{v-USPhydro+MC Sampling+UrQMD}\label{sec:frz2}

If you want to run v-USPhydro+MC Sampling+UrQMD you must set:\\ ~\\

\code{freezeout: 2} 

and then include the following lines afterwards (all parameters listed here are an example): \\ ~\\

\code{dfinputfilename: vupshydroinput2.dat \\
output\textunderscore folder: osc2u/ebe/ \\
df\textunderscore cor\textunderscore file: input/flist150.dat \\
range(ptmax,ptstepsize,phisteps): 3.0 0.1 10  \\
List\textunderscore of\textunderscore hadrons: input/resoweak.dat \\
corrections: 1 \\
number\textunderscore of\textunderscore monte\textunderscore carlo\textunderscore loops: 100 \\
output\textunderscore particles\textunderscore folder: output\textunderscore particles.dat \\
decays: 1} 

{\bf Line 19:} Name of the input file for the sampling code (useful to use different names if doing multiple runs at once so there is no overlap). Make sure the number here matches that of the run $\#$. 

{\bf Line 20:} Name of the output folder, usually, using the following is sufficient:

\code{output\textunderscore folder: osc2u/ebe/}

{\bf Line 21:} File where the list of E0, D0, and B0 are found for the $\delta f$ correction for bulk.  For the moments method at a freezeout temperature of $T=150$ MeV, one can use:

\code{df\textunderscore cor\textunderscore file: input/flist150.dat }

{\bf Line 22:} Range for the pT and phi.  We assume that pTmin=0.  The numbers are pTmax, pT step size, and number of phi steps (NOT dphi but the total number of steps)

{\bf Line 23:} List of hadrons needed.  As long as you're not running tests, using the following should be sufficient:

\code{List\textunderscore of\textunderscore hadrons: input/resoweak.dat }

{\bf Line 24:} corrections=1 if you want the inclusion of $\delta f$ corrections for viscosity and corrections=0 if you want to ignore viscous corrections to the distribution function

{\bf Line 25:} Number of Monte Carlo loops

{\bf Line 26:} File (within the subfolder flow) that lists the number of hadrons to be watched e.g pions, protons etc.  This is for the final spectra only.

{\bf Line 27:} Decays=0 if you just want to do the MC sampling, Decays=1 if you only want the spectra after decays, Decays=2 if you want the spectra both before and after decays. 

If you would like to run the output for both MC Sampling with and without decay change the last line to: \\~\\

\code{decays: 2}

\subsection{v-USPhydro+analytical Cooper Frye}\label{sec:frz1}

If you want to run v-USPhydro+analytical Cooper Frye you must set:\\ ~\\

\code{freezeout: 1} 
and then include the following lines afterwards: \\  ~\\

\code{dfinputfilename: vupshydroinput1.dat \\
df\textunderscore cor\textunderscore file: input/flist150.dat \\
range(ptmax,ptstepsize,phisteps): 5.0 0.1 \\
Number\textunderscore of\textunderscore hadrons: 1   \\
0.13957 -1 1} 

{\bf Line 33:} Name of the input file for the sampling code (useful to use different names if doing multiple runs at once so there is no overlap).  Make sure the number here matches that of the run $\#$. 


{\bf Line 34:} File where the list of E0, D0, and B0 are found for the $\delta f$ correction for bulk.  For the moments method at a freezeout temperature of $T=150$ MeV, one can use:

\code{df\textunderscore cor\textunderscore file: input/flist150.dat }

{\bf Line 36:} Range for the pT (phi is done automatically).  We assume that pTmin=0.  The numbers are pTmax and pT step size.

{\bf Line 37:} List of hadrons needed.  The number of hadrons should be at least 1 or great.  Then the following lines include the list (each hadron/line) in the order of mass, boson/fermion, degeneracy



\section{Running the Code}\label{sec:run}

There are various ways to run v-USPhydro.  The easiest way to run both the hydro combined with decays.  However, each separate part of the code can be run separately too. For this section, I will assume you have already generated initial conditions (otherwise see Sec. \ref{sec:ics} ).  

Additionally, the only requirement for running v-USPhydro is having c++ and gfortran installed (the former is needed for UrQMD).  No other files or programs are necessary.

\subsection{v-USPhydro+Analytical Cooper Frye or UrQMD}

\begin{itemize}
\item Ensure that your input file (see Sec. \ref{sec:run}) is properly set up.
\item \code{cd v-USPhydro\\
./all.sh run$\#$}
where run$\#$ is the number of your run with a corresponding input file with that number see Sec. \ref{sec:input}
\item wait for the results :)
\end{itemize}

\subsection{v-USPhydro only}

There are a few different options.  If you want to define all parameters in the inputfile "manualfile2.dat" all you need to do is run:

\begin{itemize}
\item Ensure that your input file (see Sec. \ref{sec:run}) is properly set up.
\item \code{cd v-USPhydro\\
make\\
./vusphydro
}
\end{itemize}

If you would like to specify a different input file:

\begin{itemize}
\item Ensure that your input file (see Sec. \ref{sec:run}) is properly set up.
\item \code{cd v-USPhydro\\
make\\
./vusphydro inputfilename  run$\#$}
where run$\#$ is the number of your run with a corresponding input file with that number see Sec. \ref{sec:input}
\end{itemize}

If you would like to specify a different input file and event range

\begin{itemize}
\item Ensure that your input file (see Sec. \ref{sec:run}) is properly set up.
\item \code{cd v-USPhydro\\
make\\
./vusphydro inputfilename run$\#$ event\textunderscore start event\textunderscore end} e.g. \code{.$/$vusphydro input2.dat 2 1 150}
where run$\#$ is the number of your run with a corresponding input file with that number see Sec. \ref{sec:input}
\end{itemize}

\subsection{analytical Cooper Frye}

There are a few different options.  If you want to define all parameters in the inputfile "input.dat" all you need to do is run:

\begin{itemize}
\item Ensure that your input file (see Sec. \ref{sec:run}) is properly set up.
\item \code{cd v-USPhydro$/$df\\
make\\
.$/$fo}
\end{itemize}

If you would like to specify a different input file:

\begin{itemize}
\item Ensure that your input file (see Sec. \ref{sec:run}) is properly set up.
\item \code{cd v-USPhydro$/$df\\
make\\
.$/$fo inputfilename}
\end{itemize}
Not, there is no need to specify a \nocode{run$\#$} with the analytical cooper frye.

If you would like to specify a different input file and event range

\begin{itemize}
\item Ensure that your input file (see Sec. \ref{sec:run}) is properly set up.
\item \code{cd v-USPhydro$/$df\\
make\\
.$/$fo inputfilename event\textunderscore start event\textunderscore end} e.g. \code{.$/$fo input.dat 1 150}
\end{itemize}

\subsection{Monte Carlo Sampling+UrQMD}

There are a few different options.  The easiest way to run Monte Carlo Sampling+UrQMD is using \nocode{ebe.sh} and by defining a run$\#$ with a corresponding inputfile.  For instance, you can run
\code{.$/$ebe.sh 3}
where 3 is your run$\#$ and within \nocode{ebe.sh} you have your inputfile defined e.g. line 4 within  \nocode{ebe.sh} could read
\code{.$/$fo vusphydroinput\$1.dat \$1}
where \nocode{vusphydroinput\$1.dat} is the name of your input file (\nocode{\$1} is the variable run$\#$ so in our example above the input file would be \nocode{vusphydroinput3.dat}).

You can also run a specific number of events by changing your \nocode{ebe.sh} file on line 4 to
\code{.$/$fo vusphydroinput\$1.dat \$1 event\textunderscore start event\textunderscore end}

If you want to run only the sampling and no decays, you can specify that in your input file, see Sec. \ref{sec:input}.

\section{Structure of the Code}\label{sec:struct}


This is the main file of v-USPhydro.  The files are organized as follows:
\begin{itemize}
\item EOS- eos.cpp/eos.h but tables to read them in are in tables.h and eostables.h and files to read them in happen within enetric.h/enetric.cpp.  The EOS subroutines are meant to be a black box in the sense that you can change the subroutin directly and it will be consistently affected across the entire code
\item Hydro evolution equations- primarily hydrosim.cpp/hydrosim.h but parts are found withint subroutines of Linklist.h (specifically the quantities that are affected by the link list) and particle.h
\item Initial conditions- are processed and turned into SPH particles within enetric.h/enetric.cpp but some parts are processed within Linklist.h
\item Math framework for vectors and matrices: vector.h/vector.cpp and matrix.h/matrix.cpp
\item Integration subroutines- rungekutta.h
\item Linklist- Linklist.h
\item Calculation of freezeout hypersurface - particles are indentified in hydrosim.cpp but normal vectors are calculated in Linklist.h
\item output- output.h
\end{itemize}

\section{Initial Conditions}\label{sec:ics}

See attached ics.ps for instructions.

\section{Relativistic Hydrodynamics}\label{sec:hydro}

See attached pdf's entitled General Metric etc. 

\section{Equation of State}\label{sec:eos}

We use two different tables to read in for the EOS.  temp.dat lists the temperature (in MeV) and two columns of zeros (would be used if there is a non-zero chemical potential (currently there is no infrastructure for $\mu_b\neq 0 $ in the code, though).  derv.dat lists the corresponding energy density  (in $GeV/fm^3$), pressure  (in $GeV/fm^3$),  entropy density (in $1/fm^3$),  and $\frac{dw}{ds}$ (where $w=e+p$) for each line of temperature in temp.dat.  In both files the total number of table lines is listed at the top.   A spline function is already implemented to allow for smooth derivatives of the table.

\section{Viscosity}\label{sec:visc}

The form of the viscosity can be changed within the file particle.h, specifically the subroutine:  

\code{template <int D>\\
void Particle<D>::setvisc(double bvf, double svf, int type)}

where bvf is the constant to multiple the form of $\zeta/s$ and svf is the multiplying constant for $\eta/s$.  

Edit type=1 for the bulk equation ONLY or type=3 for shear and/or shear+bulk.  The variables are then defined as follows:

\noindent zeta=$\zeta$\\
tauRelax=$\tau_{\Pi}$\\
setas=$\eta$\\
stauRelax=$\tau_{\pi}$\\

Note that the relaxation time CANNOT be smaller than dt, thus, a cutoff is made to ensure that both relaxation times are large enough.

\section{Output}\label{sec:out}

\subsection{v-USPhydro}

All output formats are within output.h.  However, they must be uncommented with the file hydrosim.cpp, otherwise they will not be called.  For instance, calling

\code{out.eprofile(linklist);}

within  hydrosim.cpp will print off the energy density profile.  However, it is usually left commented out to save space and time.  

Other possibilities that can be used but are usually commented out are:

The energy conservation

\code{out.conservation(linklist);}

And the gubser test comparison

\code{out.gubcheckux(linklist); // 
out.gubcheckuy(linklist);}

Note that some of these may have specific versions for viscous Equations of motion (but they are already included in the code and you simply need to uncomment them to use them.

\subsection{flow harmonics}

Results for the spectra and flow harmonics will be located in folders \nocode{v-USPhydro/sampling/flow/out/foldername/decays} and \nocode{v-USPhydro/sampling/flow/out/foldername/nodecays} when sampling is used, otherwise they are listed in \nocode{v-USPhydro/df/out/foldername}. The user defines \nocode{foldername}.  Each folder contains  the spectra (in \nocode{ev$\#$\textunderscore dNdphidpp.dat} is listed), the $v_n(p_T)$ (\nocode{vn\textunderscore ev$\#$.dat}) and integrated $v_n$'s (\nocode{vnintlistrun$\#$.dat}) such that for event=7 and run=3 they would be   \nocode{ev7\textunderscore dNdphidpp.dat}, \nocode{vn\textunderscore ev7.dat}, and \nocode{vnintlistrun3.dat}.  The integrated $vn$ file contains the results of all the events for that run. 

The spectra format is:

\code{hadron$\#$ $p_T$ [GeV] $\phi$ $\frac{dN}{dp_Td\phi}$}

The $v_n(p_T)$ format is (and the first line lists this also):

\code{hadron$\#$ $p_T$ [GeV] $\phi$ $\frac{dN}{dp_T}$ $v_1$ $v_2$ $v_3$ $v_4$ $v_5$ }

The integrated $v_n$ format is:

\code{hadron$\#$  $v_1$ $\psi_1$ $v_2$ $\psi_2$ $v_3$ $\psi_3$ $v_4$ $\psi_4$ $v_5$ $\psi_5$ }


Note: to compare to most experimental data you may need to calculate $\frac{dN}{2\pi p_T dp_Td\phi}$ to compare with experimental data.

Also, if you are using the analytical Cooper Frye then the integrated $v_n$'s are listed \nocode{foldernameint\textunderscore typec.dat} where \nocode{foldername} is defined by the user, \nocode{type} is either ideal, bulk or shearbulk, and $c$ is present for corrected $\delta f$ and not present if no viscous corrections are included.

\section{Analytical Cooper Frye}\label{sec:acf}

The derivations of the equations are shown already in \cite{code} and will not be repeated here.  This program calculations the spectra only from the distribution function and includes no decays.  It is located in the subfolder df. Input files should all be stored in the folder input and output files should be stored in the folder out.   This code calculations both the spectra and the flow harmonics.  It is automatically set to output $v_1$ through $v_5$ and both the $p_T$ dependent flow harmonics and the integrated $v_n$'s. 

The integrated $v_n$'s are given as a list with their file name on it.  The $p_T$ dependent flow harmonics are outputed on an event-by-event basis.  There is a small code within the subfolder out that can be run to average over all the events for each centrality class/type of equation of motion.  Simply define the parameters in the file:

\code{ out/in.dat}

and then run the code:

\code{c++ main.cpp\\
./a.out}

Make sure that you have a folder named average already created in the respective folder, otherwise the program will not run.

As for the input paramters your file \nocode{in.dat} should look like

\code{visc: bulk\\
folder: eventbyevent\textunderscore glauber/30\\
centrality: 30\\
events: 1 150\\
integrate: 0\\
bulkcorrection: 0\\
ptsize: 0 3 0.1}
where the \nocode{visc:} is your viscosity, \nocode{folder:} is the folder where the spectra are stored in, \nocode{centrality:} is your centrality class, \nocode{events:} are the number of events to average over, \nocode{integrate:} can be ignored (and will be removed eventually), \nocode{bulkcorrection:} is if you want the corrected or uncorrected $\delta f$ (with corrections =1, otherwise 0), and \nocode{ptsize:} is the minimum $p_T$, max $p_T$, and the step size.
 
It is wise to keep the individual spectra for each event because it is much quicker to calculate the flow harmonics from the already calculated spectra rather than recalculating everything.  There is a small program to do so in section Sec. \ref{sec:flow}.

\section{Monte Carlo Sampling+ UrQMD}\label{sec:MCsurqmd}

Within the subfolder sampling there are various other programs that are all needed to run MC Sampling+UrQMD.  The folders are the following:

{\bf osc2u}: osc2u is a Fortran code that coverts the results of our Monte Carlo sampling into a format that can be read into UrQMD.  Note that even osc2u requires a very specific format to run, so it would not be adviseable to change the output format from the main MC sampling code.  Furthermore, this is almost exactly the same code that is given out from S. Bass, however, I have changed the output from the double fortran format (i.e. 10D05) into the exponential format (i.e. 10E05) to make it readable by C++.  

{\bf urqmd}: urqmd runs the hadronic interactions.  You can choose what hadrons you would like to feed into the code but clearly, the more hadron you use, the more accurate it will be.  Furthermore, this is almost exactly the same code that is given out from S. Bass, however, I have changed the output from the double fortran format (i.e. 10D05) into the exponential format (i.e. 10E05) to make it readable by C++.  As far as I know, this version of UrQMD is the only one compatible with hooking up to a hydro code. If you switch between a 32 bit and 64 bit computer you may need to delete all the object files an executables and rerun the make file. 

{\bf flow}: flow reads in the output from UrQMD and puts all the Monte Carlo events into a histogram to calculation the spectra and the following flow harmonics.  Additionally, it can do the same for the MC sampling even without urqmd.  The first is saved in the folder decays and the second is in the folder no decays (for each respective output folder).  As with df the code calculates both the $p_T$ dependent flow harmonics and the integrated $v_n$'s.  Furthermore, you would still need to average over the events to obtain the average flow harmonics.

In the folder sampling itself is the MC sampling program that computes the spectra on an event-by-event basis and lets you define the number of Monte Carlo loops.  The input files can be found in the folder input.  It is easiest to run the program using the ebe.sh executable  (making sure that you have the correct input file defined within it) since there are multiple program that need to be run before obtaining the end results.

To average over the events you can simply use the same code as described in the Analytical Cooper Frye (Sec. \ref{sec:acf})

It is wise to keep the individual spectra for each event because it is much quicker to calculate the flow harmonics from the already calculated spectra rather than recalculating everything.  There is a small program to do so in section Sec. \ref{sec:flow}.

\section{Flow Harmonics from the Spectra}\label{sec:flow}

Within the file \nocode{v-USPhydro/fromspec} you can calculate the flow harmonics from the spectra themselves.  This is the quickest way to handle changes to how you want to calculate the flow harmonics (if you want to change the $\psi_n$, for instance).  The program itself reads in the various spectra (you must include the files in a folder, which you define within the file \nocode{input.dat}).  


\section{Testing}\label{sec:tests}

\subsection{Gubser Test}

\subsection{TECHQM}

\section{Troubleshooting}

\begin{itemize}
\item Error that mkdir can't make a folder.  This is because the terminal does not like to create a folder and subfolder at the same time.  If you want to output your files into something like rhic/ideal/50 then either create the folders yourself ahead of running the program or store your data in just one folder at a time (as in run first for rhic, then rhic/ideal, and finally rhic/ideal/50)
\item Error involving object files/structure.  Most likely you ran the code first on either a 32 or 64 bit computer and then switched to the other.  You need to delete all object files and executables and compile the program again.
\item Memory allocation problem.  Run the executable using valgrind (i.e. valgrind ./a.out) and it will show you where your memory allocation problems are showing up.  
\item Segmentation fault.  Either you edited the code and there is an error or there are some problems with your input file.  Some common problems are: too wide of a range of events for initial conditions that you don't actually have or not putting the number of SPH grid points at the top of an initial condition file.
\item Can't open list.dat (or whatever your list is called). This is usually because the folders weren't created correctly, sometimes rerunning everything fixes the problem.
\item If you want to run multiple types of viscosity at one time (i.e. ideal, bulk, shear+bulk etc) then it is best to run each in a separate folder.  You can use the same initial conditions, but then make sure the output folder is set to different types of folders.
\end{itemize}

\input{bibl}

\clearpage
\newpage

\end{document}


